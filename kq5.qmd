---
title: "KQ 5: Potentially Inappropriate Medications"
editor: visual
toc-title: "Sections"
toc-location: "left"
tbl-cap-location: "top"
page-layout: full
css: styles.css
tables:
      style: Table
      caption:
        pre: "Table "
        sep: " -- "
bibliography: "bib/kq5.bib"
csl: jama.csl
link-citations: no
nocite: '@*'
---

## Key Question

Among \[geriatric\] patients 65 years or older undergoing surgery and anesthesia, do commonly used potentially inappropriate medications administered during the perioperative period increase the risk of postoperative delirium or other adverse outcomes?

<!-- setup -------------------------------------------- (2022-12-24 16:56) @ --->

```{r, file = "code/readfiles_geri_2022-11-16.R"}
#| include: false
```

<!-- refids design tibbles ---------------------------- (2022-12-28 08:41) @ --->

```{r, refids}
kq5_refid_design <- study_char_dat |>
  filter(!is.na(kq5_inapp_meds)) |>
  select(refid, study, year, title, design_f, design_f_lab, starts_with("kq")) |> 
  arrange(design_f)

kq5_refid <- kq5_refid_design |> 
  pull(refid)

study_char_dat <- study_char_dat |> 
  filter(refid %in% kq5_refid) |> 
  arrange(design_f)
```

## Outcome Importance Rankings

<font size = 4> `r table_ref()` Rankings of the 5 most important outcomes (10 respondents). </font>

```{r}
#| include: false
library(reactablefmtr)
library(htmltools)

outcome_dat <- rankings("KQ5")

```

```{r}
reactable(
  outcome_dat,
  pagination = FALSE,
  defaultSorted = "any_top_5",
  defaultSortOrder = "desc",
  defaultColDef = colDef(
    cell = data_bars(outcome_dat,
      box_shadow = TRUE,
      bar_height = 12,
      max_value = 10
      # fill_color = "#B22215"
    ),
    style = cell_style(outcome_dat,
      font_size = "11px",
    )
  ),
  columns = list(
    outcome = colDef(name = "Outcome", width = 200),
    rank1 = colDef(name = "Rank 1", width = 80, headerClass = "header", align = "center"),
    rank2 = colDef(name = "Rank 2", width = 80, headerClass = "header", align = "center"),
    rank3 = colDef(name = "Rank 3", width = 80, headerClass = "header", align = "center"),
    rank4 = colDef(name = "Rank 4", width = 80, headerClass = "header", align = "center"),
    rank5 = colDef(name = "Rank 5", width = 80, headerClass = "header", align = "center"),
    any_top_5 = colDef(name = "Any", width = 80, headerClass = "header", align = "center", 
      cell = data_bars(outcome_dat, box_shadow = TRUE, bar_height = 12, max_value = 10, fill_color = "#B22215"
    ))
  ),
  theme = reactableTheme(
    borderColor = "#dfe2e5",
    stripedColor = "#f6f8fa",
    highlightColor = "#f0f5f9",
    cellPadding = "0px 0px"
  ),
  compact = TRUE,
  class = "priority-tbl"
)

```

<!-- ![](assets/pim_outcome.png){fig-align="left" width="3.5in"} -->

## Causal Model

<font size = 4> `r figure_ref()` Causal model for the relationship between potentially inappropriate medications and outcomes. Potential mediators include anesthetics, other drugs, pain, hypotension, clinical instability, infection, electrolytes, and sleep deprivation.</font>

![](assets/pim_dag.png){fig-align="center" width="8in"}

<font size = 3> PIM: potentially inappropriate medications. </font>

## Included Studies

<font size = 4> `r table_ref()` Number of studies by design. </font>

<!-- Number of studies by design ----------------------- (2022-12-28 10:44) @ --->

```{r}
study_char_dat |>
  filter(refid %in% kq5_refid) |>
  select(refid, study, design_f_lab) |>
  group_by(design_f_lab, .drop = TRUE) |>
  summarise(total = n()) |>
  adorn_totals("row") |>
  gt(id = "one") |>
  cols_label(design_f_lab = "Design", total = "Studies") |>
  cols_width(
    # design_f_lab ~ px(200),
    design_f_lab ~ "1.8in",
    total ~ ".5in"
  ) |>
  gt_theme_mg() |> 
  tab_style(
    style = list(
      cell_fill(color = "#E4F3FE"),
      cell_text(weight = "bold"),
      cell_borders(sides = c("top", "bottom"), color = "#9A9EA1", style = "solid", weight = px(1.3))
    ),
    locations = cells_body(
      rows = design_f_lab == "Total"
    )
  )
  
```

## Design, centers, country, surgery

<font size = 4> `r table_ref()` Study design, enrollment, centers, country, and surgery (see [References](#references) for citations). </font>

<!-- design, enrollment, centers ... ------------------- (2022-12-28 10:44) @ --->

```{r, included}
included_dat <- study_char_dat |>
  select(refid, starts_with("design"), study_l, year, n_enroll, n_analyze, centers, country, non_vh_hdi, starts_with("surg")) |>
  # select(refid, study, starts_with("surg")) |> # compile surgeries
  rename_with(~ gsub("surg_", "", .x, fixed = TRUE)) |>
  mutate(across(various:other, ~ gsub("surg_", "", .x, fixed = TRUE)),
    ortho_any = ifelse(if_any(contains("ortho"), ~ !is.na(.x)), "ortho", NA),
    opth = ifelse(str_detect(other_desc, "[Cc]ataract"), "optho", opth),
    gi = ifelse(!is.na(colorectal) | !is.na(gi_other) | !is.na(abdominal), "GI/Abdominal", NA),
    across(c(various, cardiac, colorectal, gyn, general, headneck, hepatic, neuro, opth, oralmax, ortho_any, ent, plastic, thoracic, urol, vasc, other), ~ firstup(.x)),
  ) |>
  unite("surgs", various, cardiac, colorectal, gyn, gi, general, headneck, hepatic, neuro, opth, oralmax, ortho_any, ent, plastic, thoracic, urol, vasc, other, sep = ":", remove = FALSE, na.rm = TRUE) |>
  select(-c(various, abdominal, cardiac, colorectal, gyn, gi, general, headneck, hepatic, neuro, opth, oralmax, ortho_any, ent, plastic, thoracic, urol, vasc, other, design_other, gi_other, starts_with("ortho"), list, other_desc, starts_with("hip"))) |>
  select(refid, study_l, design_f_lab, centers, n_enroll, country, non_vh_hdi, surgs) %>%
  arrange(design_f_lab, surgs)

included_dat |>
  group_by(design_f_lab) |>
  gt(id = "one") |>
  cols_label(
    refid = "ID",
    study_l = "Study",
    n_enroll = "Enrolled",
    country = "Country",
    centers = "Centers",
    surgs = "Surgery"
   ) |>
  cols_hide(non_vh_hdi) |>
    fmt_markdown(columns = c(study_l)) |> 
  tab_footnote(
    footnote = md("Non very high [Human Development Index](https://en.wikipedia.org/wiki/List_of_countries_by_Human_Development_Index) country."),
    locations = cells_column_labels(columns = country)
  ) |>
  tab_footnote(
    footnote = md("Non very high [Human Development Index](https://en.wikipedia.org/wiki/List_of_countries_by_Human_Development_Index) country."),
    locations = cells_body(columns = country, rows = !is.na(non_vh_hdi))
  ) |>
  tab_footnote(
        footnote = md("Various indicates more than 4 different types of surgery."),
        locations = cells_column_labels(columns = surgs)
      ) |>
  gt_theme_mg() |>
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_column_labels(
      columns = c("refid")
    )
  ) |> 
  opt_footnote_marks(marks = "letters") |> 
  tab_source_note("GI: gastrointestinal; Ortho: orthopedic; Neuro: neurological; Oralmax: oral maxillofacial; Vasc: vascular.")

```

<!-- rct w/comparators -------------------------------- (2023-01-03 16:12) @ --->

```{r}
#| eval: false
temp <- study_arm_dat |> 
  filter(refid %in% kq5_refid & design_f == "rct") |> 
  select(refid, design_f, study, arm_id, arm_n, contains("kq5"))

view_rec(742, temp)
  
  
  
  
```

## Outline

**Key question**<br/> **Included Studies**<br/> Table 1. Number of included studies according to age and design.<br/> *Design, centers, country, surgery*<br/> **Outcomes**<br/>  *Patient-reported*<br/>     Outcome One<br/>     DAG if relevant<br/>     Relevant characteristics table(s) of studies<br/>     Results<br/>     Pooled<br/>  *Clinical*<br/>     Outcome One<br/>     DAG if relevant<br/>     Relevant characteristics table(s) of studies<br/>     Results<br/>     Pooled<br/>     Synthesis other<br/> **Study/Participant Detail**<br/>     *Study Characteristics*<br/>     *Patient Characteristics*<br/> **Funding and Conflict of Interest**<br/> **Risk of Bias**<br/> **References**

[outline](obsidian://open?vault=z_obsidian_asa&file=analysis%20outline)

##  {#references}
